#!/bin/bash
# Post-checkout hook to sync dependencies when pyproject.toml changes

# Get the previous and new HEAD commits
OLD_HEAD=$1
NEW_HEAD=$2
BRANCH_CHECKOUT=$3

# Only run on branch checkouts, not file checkouts
if [ "$BRANCH_CHECKOUT" != "1" ]; then
    exit 0
fi

# Check if pyproject.toml has changed
if git diff --name-only "$OLD_HEAD" "$NEW_HEAD" | grep -q "^pyproject.toml$"; then
    echo "üì¶ pyproject.toml has changed, running uv sync..."

    # Check if uv is installed
    if ! command -v uv &> /dev/null; then
        echo "‚ö†Ô∏è  uv is not installed. Please install it:"
        echo "    curl -LsSf https://astral.sh/uv/install.sh | sh"
        exit 0
    fi

    # Run uv sync
    uv sync --all-extras

    if [ $? -eq 0 ]; then
        echo "‚úÖ Dependencies synced successfully!"
    else
        echo "‚ö†Ô∏è  Failed to sync dependencies. Run 'uv sync --all-extras' manually."
    fi
fi

exit 0
