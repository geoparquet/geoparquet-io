#!/bin/bash
# Commit message hook to enforce imperative mood

commit_regex='^(Add|Fix|Update|Remove|Refactor|Improve|Create|Delete|Rename|Move|Change|Implement|Optimize|Simplify|Enhance|Document|Test|Build|Release|Merge|Revert|Clean|Format|Style|Bump|Configure|Enable|Disable|Allow|Prevent|Handle|Support|Use|Replace|Convert|Extract|Inline|Split|Combine|Sort|Validate|Check|Ensure|Make|Set|Get|Skip|Include|Exclude|Ignore|Apply|Generate|Parse|Process|Execute|Initialize|Setup|Install|Uninstall|Upgrade|Downgrade|Migrate|Restore|Reset|Clear|Show|Hide|Open|Close|Start|Stop|Begin|End|Increase|Decrease|Raise|Lower|Extend|Reduce|Expand|Collapse|Group|Ungroup|Wrap|Unwrap|Pin|Unpin|Lock|Unlock|Enable|Disable|Connect|Disconnect|Attach|Detach|Mount|Unmount|Load|Unload|Save|Copy|Paste|Cut|Undo|Redo|Import|Export|Download|Upload|Sync|Fetch|Pull|Push|Clone|Fork|Branch|Tag|Commit|Stash|Pop|Checkout|Switch|Merge|Rebase|Cherry-pick|Squash|Amend|Annotate|Blame|Bisect|Log|Diff|Grep|Status|Reset|Revert|Clean|Archive|Streamline|Consolidate|Standardize) '

commit_message=$(cat "$1")

# Skip merge commits
if echo "$commit_message" | grep -q "^Merge"; then
    exit 0
fi

# Check if message starts with imperative verb
if ! echo "$commit_message" | grep -qE "$commit_regex"; then
    echo "❌ Commit message must start with an imperative verb!"
    echo "   Bad:  'Added new feature' or 'Adding new feature'"
    echo "   Good: 'Add new feature'"
    echo ""
    echo "Common verbs: Add, Fix, Update, Remove, Refactor, Improve, Document"
    echo "Your message: $commit_message"
    exit 1
fi

# Warn about overly long messages (but don't block)
first_line=$(echo "$commit_message" | head -n1)
if [ ${#first_line} -gt 72 ]; then
    echo "⚠️  First line of commit message is ${#first_line} chars (recommended: <72)"
fi

exit 0
